"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createController = void 0;
const tslib_1 = require("tslib");
const Eta = tslib_1.__importStar(require("eta"));
const path = tslib_1.__importStar(require("path"));
const file_system_1 = require("./utils/file-system");
const relationships_1 = require("./utils/relationships");
const createController = async (apiBaseDir, entity, relationshipMap) => {
    const { name: entityName } = entity;
    const File = path.join(apiBaseDir, `${entityName}.controller.ts`);
    const testFile = path.join(apiBaseDir, `${entityName}.controller.spec.ts`);
    // Dependencies
    const svcName = `${entityName}Service`;
    const ctrlName = `${entityName}Controller`;
    const pluralEntityName = `${entityName}s`;
    const relationships = (0, relationships_1.getRelationshipForTemplate)(entityName, relationshipMap[entityName]);
    const nestedRelationships = (0, relationships_1.getNestedRelationships)(entityName, relationshipMap);
    const data = {
        svcName,
        ctrlName,
        entityName,
        pluralEntityName,
        // ensure uniqueness
        associations: [...new Set(relationships)],
        nestedAssociations: [...new Set(nestedRelationships)],
    };
    Eta.configure({
        views: path.join(__dirname, "templates"),
    });
    const content = await Eta.renderFileAsync("./rest/controller-rest", data);
    (0, file_system_1.createFile)(File, content);
    const testContent = await Eta.renderFileAsync("./rest/controller-rest-spec", data);
    (0, file_system_1.createFile)(testFile, testContent);
};
exports.createController = createController;
