"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createDirectoryContents = exports.createFile = void 0;
const tslib_1 = require("tslib");
const path = tslib_1.__importStar(require("path"));
const fs = tslib_1.__importStar(require("fs"));
const createDir = (dirname) => {
    if (!fs.existsSync(dirname)) {
        fs.mkdirSync(dirname, { recursive: true });
    }
};
const createFile = (file, content) => {
    const dirname = path.dirname(file);
    createDir(dirname);
    fs.writeFileSync(file, content);
};
exports.createFile = createFile;
const createDirectoryContents = (templatePath, newProjectPath, apiType) => {
    const filesToCreate = fs.readdirSync(templatePath);
    const CURR_DIR = process.cwd();
    filesToCreate.forEach((file) => {
        const origFilePath = `${templatePath}/${file}`;
        // get stats about the current file
        const stats = fs.statSync(origFilePath);
        if (stats.isFile()) {
            writeFile(file, origFilePath, `${CURR_DIR}/${newProjectPath}`, stats.mode, apiType);
        }
        else if (stats.isDirectory()) {
            fs.mkdirSync(`${CURR_DIR}/${newProjectPath}/${file}`);
            // recursive call
            (0, exports.createDirectoryContents)(`${templatePath}/${file}`, `${newProjectPath}/${file}`, apiType);
        }
    });
};
exports.createDirectoryContents = createDirectoryContents;
/* eslint-disable max-params */
const writeFile = (fileName, origFilePath, writePath, mode, apiType) => {
    const contents = fs.readFileSync(origFilePath, "utf8");
    if (fileName.startsWith("app.module") && fileName.includes(apiType)) {
        fileName = "app.module.ts";
        const fileWritePath = `${writePath}/${fileName}`;
        fs.writeFileSync(fileWritePath, contents, "utf8");
        fs.chmodSync(fileWritePath, mode);
    }
    else if (!fileName.startsWith("app.module")) {
        if (fileName === ".npmignore")
            fileName = ".gitignore";
        const fileWritePath = `${writePath}/${fileName}`;
        fs.writeFileSync(fileWritePath, contents, "utf8");
        fs.chmodSync(fileWritePath, mode);
    }
};
